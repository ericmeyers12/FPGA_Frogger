% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% IEEE Style - Double columns, 11pt font, letterpaper
\documentclass[journal, twocolumn, final,11pt,letterpaper]{IEEEtran}	

% Include Latex Packages
\input{header.tex}


% Title of Document
\title{ECE385 Experiment \#5
	}
\author{
\IEEEauthorblockN{Eric Meyers, Ryan Helsdingen}\\
\IEEEauthorblockA{Section ABG; TAs: Ben Delay, Shuo Liu \\
February 24th, 2016 \\
emeyer7, helsdin2}}
% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 
\begin{document}
	
%SECTION : Formatting and Title
\maketitle
\singlespacing

%SECTION 1 - Introduction - Eric
\section{Introduction}
The purpose of this lab was to design and construct a 2s compliment 8-bit multiplier that uses a shift-and-add algorithm. The user will input their desired multiplicand and multiplier into switches and these will be stored in two shift registers (A and B). The multiplier is built upon a control unit with a state machine, so once the "run" button is pressed, the machine will cycle through multiple states and output the value in the combined 16-bit value "AB".

%SECTION 2 - 8-bit Multiplication Example - Ryan
\section{8-bit Multiplication Example}
Table \ref{tab:table1} shows each step of the multiplication process given inputs Multiplier B=7 and Multiplicand S=-59.  The result is -413 in decimal and 1111 1110 0110 0011 in binary.  As you can see, bolded at the bottom of Table \ref{tab:table1} is the expected result loaded into A and B. Shift functions occur eight times, right-shifting the bit.  Add functions occur before each shift and only if the previous M bit is equal to 1.  During an add function, S gets added to A.  The only exception is before the eighth shift which would be a subtract function rather than an add function.  S would get subtracted from A.  This exception, as you can see, is not needed for this example.


\begin{table}[htbp]
	\centering
	\caption{Reworked 8-bit Multiplication Problem. }
	\begin{tabular}{ccccc}	% ccccccc indicates 7 center aligned columns
		\toprule	% top separator
		Function & X & A & B & M \\
		\midrule
		Clr\_A\_Ld\_B & 0 & 0000 0000 & 0000 0111 & 1 \\ 
		ADD (1)    & 1 & 1100 0101 & 0000 0111 & 1 \\
		SHIFT (1)  & 1 & 1110 0010 & 1000 0011 & 1 \\

		ADD (2)    & 1 & 1010 0111 & 1000 0011 & 1 \\
		SHIFT (2)  & 1 & 1101 0011 & 1100 0001 & 1 \\		
		ADD (3)    & 1 & 1001 1000 & 1100 0001 & 1 \\
		SHIFT (3)  & 1 & 1100 1100 & 0110 0000 & 0 \\		
		SHIFT (4)  & 1 & 1110 0110 & 0011 0000 & 0 \\		
		SHIFT (5)  & 1 & 1111 0011 & 0001 1000 & 0 \\		
		SHIFT (6)  & 1 & 1111 1001 & 1000 1100 & 0 \\		
		SHIFT (7)  & 1 & 1111 1100 & 1100 0110 & 0 \\		
		SHIFT (8)  & 1 & \textbf{1111 1110} & \textbf{0110 0011} & 1 \\
		\bottomrule	% bottom separator
	\end{tabular}%
	\label{tab:table1}	% this is the label given to the table that can be referenced using \ref{tab:Exp1Part1_7}
\end{table}%


%SECTION 3 - Description of Circuit - Eric
\section{Description of Circuit}
The purpose of the 8-bit multiplier is to take two 8-bit user-defined words, multiply them together and place the resulting product in the two combined registers. \\

Initially both storage registers will begin with 00000000 loaded into them. On the Altera Board, the operator will control the last eight general purpose switches to indicate what the word they wish to load is, then press the "Clear\_A\_Load\_B" push button to the right. This will then take the switch values and load them into Register B. Therefore after this operation is performed, A will still contain 00000000, and B will contain XXXXXXXX (X being the value the user defines).\\

Then once the user indicates the multiplier (Register B), they will then indicate the multiplicand by changing the order of the eight switches. Once this is done, then the user will press the "Run" switch and the control unit will cycle through all states within the FSM and come to a halt. The product of the two values will be displayed in register AB(concatenated A + B) and the X bit will be displayed on the green LED next to the HEX values. \\

The FSM is a part of the control unit and will be explained below and the "X-bit" will also be described in detail below. 

%SECTION 4 - Purpose of Modules - Eric
\section{Purpose of Modules}
Please refer to Figure \ref{fig:block-diagram} to understand the how each module interacts with one another. The multiplier is broken down into four primary modules as listed below:
\begin{itemize}
	\item Shift Register 
	\item Full Adder/Subtractor
	\item Control Unit 
	\item X Register 
\end{itemize} 

The first of these modules is the shift register and it's purpose is to store the contents of each 8-bit word the user specifies. The concatenation of the two registers together (AB) contains the 16-bit product of the multiplication. The shift register shifts right when enabled by the control unit, pushing the least significant bit out through its "shift\_out" output. The data also is parallel loaded in through its input in the module and has parallel outputs used to display on LEDs on the Altera Board. \\

The next module is the Full Adder/Subtractor which essentially does exactly what it states: both adds and subtracts (depending on the control unit). The inputs are 16 data bits (8 bits for A and 8 bits for B) and a "subtract" bit which indicates whether or not subtraction must be performed.\\

Because subtraction is adding the 2s complement of a number, the team decided to use a trick learned back in Lab 3. To get the 2s complement, one must flip all of the bits and add one. To conditionally flip all of the bits, the team used an XOR gate with inputs of B and the "subtract" bit. This is because if the "subtract" bit is high, then the B value must be flipped, and if it is low then it stays the same. Then this logic value must be fed into the nine inputs of the full adders along with the "subtract" bit on the first full adder. Please reference Figure \ref{fig:full-adder-subtractor-diagram} to get a better understanding of this. \\

This setup will take the 2s complement of the number and add it to the A value if the "subtract" bit is high, but if the "subtract" bit is low then it will simply regularly add the two A and B values. \\

The next module is the Control Unit which dictates how the Finite State Machine operates and how the entire circuit functions. This unit takes in 3 inputs (Run, Reset, and Clear\_A\_Load\_B) that are designated by the operator. These inputs then determine the outputs of the control unit which are Load, Shift, Add, and Shift. These four outputs are determined by the Finite State Machine described in "Section V: State Diagram".\\

 Essentially, the outputs are telling each module if they are in use or not. So for example, if the multiplier needs to perform an "Add" or "Subtract" operation, it will output a high value on the respective output and this will be then fed into the proper module which will then be activated. \\

Last but not least is the "X Register" Module which contains the status of the "X" bit. The "X" bit is essentially the most significant bit in the A register. This register tells whether the result of the multiplication is positive or negative and is mainly used to view the output of the multiplication on the Altera Board by feeding it into a green LED to see its status. 

%SECTION 5 - State Diagram of FSM - Ryan
\section{State Diagram}
The State Machine for the 8-bit Multiplier is shown in Figure \ref{fig:FSM} in "Section X: Figures" of this document.  \\

The State Machine is broken down into a total of five states labeled A through E, with A being the reset\_state and E being the done\_state. The start\_state is made up of 16 substates for the 7 add functions, 1 subtract function, and 8 shift functions.  

%SECTION 6 - Schematic/Block Diagram -Eric
\section{Schematic/Block Diagram}
Please refer to "Section X : Figures" of this document to view the Schematic/Block Diagrams. Figure \ref{fig:full-multiplier-diagram} displays the entire block diagram of the multiplier, with block labels and interconnections. The multiplier, as stated before is broken down into several modules. Those modules are as follows with the figure references aside them:
\begin{itemize}
	\item Shift Register - Figure \ref{fig:shift-register-diagram}
	\item Full Adder/Subtractor - Figure \ref{fig:full-adder-subtractor-diagram}
	\item Control Unit - Figure \ref{fig:top-half-control} (Top Half Only)
	\item Control Unit - Figure \ref{fig:bottom-half-control} (Bottom Half Only)
	\item X Register - Figure \ref{fig:x-ff-diagram}
\end{itemize}

%SECTION 7 - Pre-Lab Simulation Waveforms -Eric
\section{Pre-Lab Simulation Waveforms}
Please refer to "Section X : Figures" of this document to view the Pre-Lab Simulation Waveforms. There was a total of four simulations performed. All options were explored on this multiplier and the following inputs were used: 
\begin{itemize}
	\item \textbf{+}7 * \textbf{-}59 - (Figure \ref{fig:simulation1})
	\item \textbf{-}7 * \textbf{+}59 - (Figure \ref{fig:simulation2t})
	\item \textbf{+}7 * \textbf{+}59 - (Figure \ref{fig:simulation3})
	\item \textbf{-}7 * \textbf{-}59  - (Figure \ref{fig:simulation4})
\end{itemize}
%SECTION 8 - Post Lab -Ryan
\section{Post Lab}
1)  Refer to the Design Resources and Statistics in IQT.30-32 and complete
the following design statistics table.\\

These numbers are shown below in Table \ref{tab:lab5-statistics} .

\begin{table}[htbp]
	\centering
	\caption{Reworked 8-bit Multiplication Problem. }
	\begin{tabular}{c|c}	% ccccccc indicates 7 center aligned columns
		\toprule	% top separator
		Resource & Value \\
		\midrule
		LUT & 95\\
		DSP & 0\\
		Memory (BRAM) & 0\\
		Flip-Flop & 0\\
		Frequency & 239.52 MHz\\
		Static Power & 98.52 mW\\
		Dynamic Power & 0 mW\\
		Total Power & 147.8 mW\\
		\bottomrule	% bottom separator
	\end{tabular}%
	\label{tab:table2}	% this is the label given to the table that can be referenced using \ref{tab:Exp1Part1_7}
\end{table}%
 
Come up with a few ideas on how you might optimize your design to decrease the total gate count and/or to increase maximum frequency by changing your code for the design.\\

\textit{Answer:} The implementation of the full 9-bit adder could be changed to incorporate the techniques in the previous lab. Specifically, the carry-ripple adder could be changed into a carry-ahead adder and this would theoretically not change the gate cound (as shown by previos lab Resource Analysis) and it would increase the frequency by approximately 2 MHz. \\

Another idea to decrease the gate count would be to remove the X Register and not display the negative sign on the LED. This would remove one flip-flop and make it so that the shift-in to the A register would simply be the most significant bit of the A register (i.e. the most significant bit would be shifted in).

%SECTION 9 - Conclusion - Ryan
\section{Conclusion}
In this lab, the team was able to successfully program and test a working 8-bit multiplier on the DE2 FPGA board, concatenating an 8-bit multiplier and 8-bit multiplicand into a 16-bit solution.  The design used a total of 95 logic elements functioning at a frequency of 239.52 MHz.  Both values could be improved, that is, the number of logic elements decreased and the frequency increased through optimizing such things as the implementation of the add function to a CLA based off the results of Lab 4.  Overall, this lab provides a bridge from the basic adder design from lab 4 to the design of the SLC-3 in the next lab.    

\clearpage
\onecolumn
%SECTION 10: Figures
\section{Figures}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.4]{simulation1.png}
	\caption{ModelSim Simulation Output (+7 * -59)\label{fig:simulation1}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.4]{simulation2.png}
	\caption{ModelSim Simulation Output (-7 * +59)\label{fig:simulation2t}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.4]{simulation3.png}
	\caption{ModelSim Simulation Output (+7 * +59)\label{fig:simulation3}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.4]{simulation4.png}
	\caption{ModelSim Simulation Output (-7 * -59)\label{fig:simulation4}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.6]{Block_Diagram.png}
	\caption{Incomplete Module Block Diagram\label{fig:block-diagram}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.4]{full-multiplier-diagram.png}
	\caption{Full Multiplier Block Diagram\label{fig:full-multiplier-diagram}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.5]{shift-register-diagram.png}
	\caption{Shift Register Block Diagram\label{fig:shift-register-diagram}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.5]{full-adder-subtractor-diagram.png}
	\caption{Full Adder and Subtractor Block Diagram\label{fig:full-adder-subtractor-diagram}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.55]{control-unit-top-half-diagram.png}
		\caption{Top Half Control Unit Block Diagram\label{fig:top-half-control}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.65]{control-unit-bottom-half-diagram.png}
	\caption{Bottom Half Control Unit Block Diagram\label{fig:bottom-half-control}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.4]{x-ff-diagram.png}
	\caption{X-Bit Flip Flop Block Diagram\label{fig:x-ff-diagram}}
\end{figure}

\begin{figure} [htbp]
	\centering
	\includegraphics[scale=0.65]{FSM.jpg}
	\caption{Multiplier State Diagram\label{fig:FSM}}
\end{figure}




%SECTION : Bibliography
%Insert Bibliography if needed

\end{document}